ADD_LIBRARY (IMPORTED_MSGPACK SHARED IMPORTED GLOBAL)

INCLUDE(ExternalProject)

ExternalProject_Add(LIBMSGPACK_BUILD
        PREFIX ${CMAKE_CURRENT_BINARY_DIR}
        GIT_REPOSITORY https://github.com/msgpack/msgpack-c.git
        GIT_TAG "master"
        UPDATE_COMMAND ""
        INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}
        CMAKE_ARGS "-DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_CURRENT_BINARY_DIR}"
        LOG_DOWNLOAD ON
        LOG_CONFIGURE ON
        LOG_BUILD ON
        LOG_INSTALL ON
        )

ExternalProject_Get_Property(LIBMSGPACK_BUILD INSTALL_DIR)

FILE (MAKE_DIRECTORY "${INSTALL_DIR}/lib" "${INSTALL_DIR}/include")
SET (MSGPACK_INCLUDE_DIR "${INSTALL_DIR}/include")
SET (MSGPACK_LIBRARY "${INSTALL_DIR}/lib/libmsgpackc.so")

ADD_DEPENDENCIES (IMPORTED_MSGPACK LIBMSGPACK_BUILD)

MESSAGE (STATUS "MSGPACK IS ${MSGPACK_LIBRARY}")
MESSAGE (STATUS "MSGPACK_INCLUDE_DIR IS ${MSGPACK_INCLUDE_DIR}")

SET_TARGET_PROPERTIES (IMPORTED_MSGPACK PROPERTIES IMPORTED_LOCATION ${MSGPACK_LIBRARY} INTERFACE_INCLUDE_DIRECTORIES ${MSGPACK_INCLUDE_DIR})
