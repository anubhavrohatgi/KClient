ADD_LIBRARY (IMPORTED_GTEST SHARED IMPORTED GLOBAL)

INCLUDE(ExternalProject)

ExternalProject_Add(LIBGTEST_BUILD
        PREFIX ${CMAKE_CURRENT_BINARY_DIR}
        URL http://www.meocci.it/googletest-release-1.8.0.tar.gz
        UPDATE_COMMAND ""
        INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}
        CMAKE_ARGS "-DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_CURRENT_BINARY_DIR}"
	BUILD_IN_SOURCE OFF
        LOG_DOWNLOAD ON
        LOG_CONFIGURE ON
        LOG_BUILD ON
        LOG_INSTALL ON
        )

ExternalProject_Get_Property(LIBGTEST_BUILD INSTALL_DIR)

FILE (MAKE_DIRECTORY "${INSTALL_DIR}/lib" "${INSTALL_DIR}/include")
SET (GTEST_INCLUDE_DIR "${INSTALL_DIR}/include")
SET (GTEST_LIBRARY "${INSTALL_DIR}/lib/libgtest.a")

ADD_DEPENDENCIES (IMPORTED_GTEST LIBGTEST_BUILD)

MESSAGE (STATUS "GTEST_LIBRARY IS ${GTEST_LIBRARY}")
MESSAGE (STATUS "GTEST_INCLUDE_DIR IS ${GTEST_INCLUDE_DIR}")

SET_TARGET_PROPERTIES (IMPORTED_GTEST PROPERTIES IMPORTED_LOCATION ${GTEST_LIBRARY} INTERFACE_INCLUDE_DIRECTORIES ${GTEST_INCLUDE_DIR})
