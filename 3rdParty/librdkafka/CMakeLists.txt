INCLUDE(ExternalProject)

ExternalProject_Add(LIBRDKAFKA_BUILD
        PREFIX ${CMAKE_CURRENT_BINARY_DIR}
        URL https://github.com/edenhill/librdkafka/archive/debian/0.9.1-1.tar.gz
        UPDATE_COMMAND ""
        BUILD_IN_SOURCE ON
        CONFIGURE_COMMAND ./configure --prefix=<INSTALL_DIR> ${CONFIGURE_FLAGS}
        BUILD_COMMAND make -j4
        INSTALL_COMMAND make install
        INSTALL_DIR INSTALL
        LOG_DOWNLOAD ON
        LOG_CONFIGURE ON
        LOG_BUILD ON
        LOG_INSTALL ON
        )

ExternalProject_Get_Property(LIBRDKAFKA_BUILD INSTALL_DIR)
ADD_LIBRARY (IMPORTED_LIBRDKAFKA SHARED IMPORTED GLOBAL)
ADD_LIBRARY (IMPORTED_LIBRDKAFKAPP SHARED IMPORTED GLOBAL)

FILE (MAKE_DIRECTORY "${INSTALL_DIR}/lib" "${INSTALL_DIR}/include")
SET (LIBRDKAFKA_INCLUDE_DIR "${INSTALL_DIR}/include")
SET (LIBRDKAFKA_LIBRARY "${INSTALL_DIR}/lib/librdkafka.so")
SET (LIBRDKAFKAPP_LIBRARY "${INSTALL_DIR}/lib/librdkafka++.so")


ADD_DEPENDENCIES (IMPORTED_LIBRDKAFKA LIBRDKAFKA_BUILD)
ADD_DEPENDENCIES (IMPORTED_LIBRDKAFKAPP LIBRDKAFKA_BUILD)

MESSAGE (STATUS "LIBRDKAFKA_LIBRARY IS ${LIBRDKAFKA_LIBRARY}")
MESSAGE (STATUS "LIBRDKAFKA_INCLUDE_DIR IS ${LIBRDKAFKA_INCLUDE_DIR}")

SET_TARGET_PROPERTIES (IMPORTED_LIBRDKAFKA PROPERTIES IMPORTED_LOCATION ${LIBRDKAFKA_LIBRARY} INTERFACE_INCLUDE_DIRECTORIES ${LIBRDKAFKA_INCLUDE_DIR})
SET_TARGET_PROPERTIES (IMPORTED_LIBRDKAFKAPP PROPERTIES IMPORTED_LOCATION ${LIBRDKAFKAPP_LIBRARY} INTERFACE_INCLUDE_DIRECTORIES ${LIBRDKAFKA_INCLUDE_DIR})